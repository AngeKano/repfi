je dois metre en place un ETL de traitement de fichier et de chargement dans un datawarehouse clickhouse

l'etl traite les fichierx excel puis se rend les table dui datawarehouse pour les alimenter 
on a en tous 5 fichiers a traiters

Etape 1 via mon app un tulisateur upload un fichiers excel dans le rpertoire specifique sur AWS S3
une fois le fichier bien uploader 
L'ETL doit etre declacher par un button sur mon app elt se lance automatiquement peut etre soit declancher a distance 

NB: l'app concerne plusieurs entreprise l'etel doit pour voir gerer tous ces clients 
Envol
    /comtable
        /periode

LVMH
     /comtable
        /periode
 ...


Etape 2 traitement de des fichiers comptables 

Il exsites 4 tables dans le clickhouse

Tables de dimension
Plan Tiers
Plan Comptable
Code Journal

Tables de faits
Grand livre

Ils existent 5 fichiers de type diferrent des fichiers excel


Fichiers pour les Tables de dimension  
Plan Tiers
Plan Comptable
Code Journal

Tables de faits
Grand livre des comptes
Grand livre des tiers

les fonctions de traitement on y revinendra
NB: les fichiers doit etre present pour debuter le traitement des 5

Une fois traiters les fichier sont deplacer dasn un sous repertoire que tu cree success/sources et les fiche=ier resultat des 4 table fait et dimenssions dans le repertoire success/resultat dans le repertoire courant dans lequel se trouve les fichiers traité sur AWS S3
et ensuite met a jour les tables de dimensions puis celle de fais 
je te dirai plutart comment le faire les mise a jour de tables se font 

Juste apers ca 
Propspose une methode de communiquation pour dire a mon postrgres ( vu que le postgres enregistre ls transaction de fichiers et autres ) que les fichier on bien ete traité et que le clichouse esta jour pour info le clikhouse esrt le meme vps que le projet intefrace upload files avec le postgres 

donne moi juste ta methodolige pouyr suivre tous ce flux du fichier uplaod a a sont traitemnent et sont chargement sur clickhouse 


Discuttons juste pose moi des questions 
J'ai deja un projet airflow qui fonctionne deja tres mais en local bien 

Je veux aussi rajouter a mon prjet nextjs diferention en fichier simple a un fichier 

J'ai un projet next js 

qui fait de gestion comptables 

dans une parti de mon gere un certains de nombre de fihiers

Je veux aujourdui les sinder en 2 groupe les fichiers 
"normaux"
Et ceux dit fichier " comptables"
les fichier normaux sont les fichier qui sont uploader en vraque sur le systeme sans grande interer derire il sont juste stocker pour etre telecharge plutard ce sont des fichier excel pdf image word docs .mae (format fichier sage) 

qui uploader et ranger dasns l'app l'utisateur peut meme cree des sout document pour y rajouter des ces fichiers 
il peut cree des sous dossier pour metre ces fichiers les supprimer un comme sur un google drive ces fichier n'on pas d'incidance reel elle sont juste stocker sur AWS S3 et lu peuvent etre suprimer renomer comme tous fichiers files et cela modife la dsiposition du AWS S3 le nom des repertoire et autres 

Ensuite on des fichier di fichiers comptables qui sont eux une fois upload sont traiter par mon ETL Apache Airflow pour aliment er un bd clickhouse elle est defini sur un peridoe la notion de periode est res importate lors 

Comment ceci se passe sur l'interface
L'utilisation clique sur declaration comptables on lui de mande alors obligatoirement 5 fichiers obligatoire de 5 categorie differente en format execl obigatoire  
enum FileType {
  GRAND_LIVRE_COMPTES
  GRAND_LIVRE_TIERS
  PLAN_COMPTES
  PLAN_TIERS
  CODE_JOURNAL
}

Ensuite mon script doit lancer une verification de conformite de periode qui verifi si un les document sont 
coorend en periode 
on doit lire les fichers de type
  GRAND_LIVRE_COMPTES
  GRAND_LIVRE_TIERS

ce sont des fichier execel 
lire les fichier et recherher la periode 
dans le files il existe un 
il doitlire outes les ligne a la recher de celle qui fait mention de "Période du" c'est sur cette ligne que se trouve la periode de debut 
aussi cherche la ligne ou il fait mention uniqueemnt de "au" en generalla ligne d'en bas c'est elle qui contient la date de fin de la periode 
format de date "01/01/2024" ou "31/12/24" faudrait s'y adapter 

les dates sur les fichiers
  GRAND_LIVRE_COMPTES
  GRAND_LIVRE_TIERS
doivent etre similaire debut fin sinon la declaration comtables n'est pas valide

verifier que les autres fichiers ne soit pas vide ou corompu 
5 type diffeents pas de doublon 
si toutu est ok alors on les stocke dasn le repertoire 
on modife alors leur nom de fichier de base 
exemmple AnneeMoisJour_TYPE_Nom_client

20241231_GrandLivre_Envol
20241231_GrandLivreTiers_Envol
20241231_PlanTiers_Envol
20241231_PlanComptes_Envol
20241231_CodeJournal_Envol

aussi un cree des backup si un utilsatuer relance de nouveau sur un perriode avec de nouveau fichier on ne supprimer pas ecrasse pas les ancienne mais on les deplace dasn un sous repertoire 
backup/
    AnneMoisJour_heuresMinuteSecond/
        20241231_GrandLivre_Envol
        20241231_GrandLivreTiers_Envol
        20241231_PlanTiers_Envol
        20241231_PlanComptes_Envol
        20241231_CodeJournal_Envol


Exmple que je porpose base toi sur ca pour fair eles tiens 
Structure AWS S3

nom_client-id/
    folder/ 
        ....
    declaration/
        2024/
            periode-24_01_01-24_12_31/
                20241231_GrandLivre_Envol
                20241231_GrandLivreTiers_Envol
                20241231_PlanTiers_Envol
                20241231_PlanComptes_Envol
                20241231_CodeJournal_Envol
                sucess/
                    sources/
                        20241231_GrandLivre_Envol
                        20241231_GrandLivreTiers_Envol
                        20241231_PlanTiers_Envol
                        20241231_PlanComptes_Envol
                        20241231_CodeJournal_Envol  
                    resultats/
                            20241231_GrandLivre_Envol
                            20241231_PlanTiers_Envol
                            20241231_PlanComptes_Envol
                            20241231_CodeJournal_Envol
                backup/
                    AnneMoisJour_heuresMinuteSecond/
                        20241231_GrandLivre_Envol
                        20241231_GrandLivreTiers_Envol
                        20241231_PlanTiers_Envol
                        20241231_PlanComptes_Envol
                        20241231_CodeJournal_Envol

        
Donne moi ton approche 

Fonctionnalite attendu

Gestionde fichiers  CRUD un peu comme un google drive
gestion des fichier compteables avec un veux avoire une gestionde s periode et la possibliter de faire des restaurationd e backup sur certianne periode defini 
comme une tmie line qui fait le recap des changements realiser et qui gere les les version la periode je rapele n'exede pas une année

Enfin celui qui uplad doit voir que la periodede traitement est en cour de traitement  et que une fois la periodes cest adire les 5 fichiers traiter et mis dasn le clickhouse il dois le savoir automatiquement et le chartt chand cdn doi se metre à jour

Nb sir une periode a dejat ete defini et traite que derrie l'utilisatuer lance un triatement sur une periode qui couvre une parti de l'ancien alors in est impossible de le faire soit il chois de repredre la periode totablement soit il en rajoute de nouvelle periode


